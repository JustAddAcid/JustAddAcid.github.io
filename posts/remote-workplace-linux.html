<!DOCTYPE html><html lang="ru"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"/><link rel="manifest" href="/favicon/site.webmanifest"/><link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#000000"/><link rel="shortcut icon" href="/favicon/favicon.ico"/><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-config" content="/favicon/browserconfig.xml"/><meta name="theme-color" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><meta name="description" content="Nosoff.info -- personal blog"/><title>Организуем удалённое рабочее место на машине с linux</title><meta property="og:image" content="/assets/blog/remote-workplace-linux/logo.jpg"/><meta name="next-head-count" content="15"/><link rel="preload" href="/_next/static/css/b53dc93c726b8658a966.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b53dc93c726b8658a966.css"/><link rel="preload" href="/_next/static/css/660f735cfd0633f1a2b3.css" as="style"/><link rel="stylesheet" href="/_next/static/css/660f735cfd0633f1a2b3.css"/><link rel="preload" href="/_next/static/css/c77a6c1079e98ec5fcc2.css" as="style"/><link rel="stylesheet" href="/_next/static/css/c77a6c1079e98ec5fcc2.css"/><link rel="preload" href="/_next/static/gJJRndGKyN6sCjXIhsPQK/pages/_app.js" as="script"/><link rel="preload" href="/_next/static/gJJRndGKyN6sCjXIhsPQK/pages/posts/%5Bslug%5D.js" as="script"/><link rel="preload" href="/_next/static/runtime/webpack-c212667a5f965e81e004.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.e84fa698c7ee940652bd.js" as="script"/><link rel="preload" href="/_next/static/chunks/4f691431.e05b9cac0aab3e16d0b1.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.ceeeee915f5ebe162cf6.js" as="script"/><link rel="preload" href="/_next/static/runtime/main-3daf36a84c7bc857251c.js" as="script"/><link rel="preload" href="/_next/static/chunks/6bb8d0b32c277f4d448b0d2b473f0efce76a1e26.d11d7791f553e1ee81f3.js" as="script"/></head><body><div id="__next"><div class="min-h-screen"><main><div class="container mx-auto px-5"><h2 class="text-2xl md:text-4xl font-bold tracking-tight md:tracking-tighter leading-tight mb-20 mt-8"><a class="hover:underline" href="/">Nosoff.info</a></h2><article class="mb-32"><h1 class="text-6xl md:text-7xl lg:text-8xl font-bold tracking-tighter leading-tight md:leading-none mb-12 text-center md:text-left">Организуем удалённое рабочее место на машине с linux</h1><div class="hidden md:block md:mb-12"><div class="flex items-center"><img src="/assets/blog/authors/romannosov.png" class="w-12 h-12 rounded-full mr-4" alt="Roman A. Nosov"/><div class="text-xl font-bold">Roman A. Nosov</div></div></div><div class="mb-8 md:mb-16 -mx-5 sm:mx-0"><div class="-mx-5 sm:mx-0"><img src="/assets/blog/remote-workplace-linux/logo.jpg" alt="Cover Image for Организуем удалённое рабочее место на машине с linux" class="shadow-small"/></div></div><div class="max-w-2xl mx-auto"><div class="block md:hidden mb-6"><div class="flex items-center"><img src="/assets/blog/authors/romannosov.png" class="w-12 h-12 rounded-full mr-4" alt="Roman A. Nosov"/><div class="text-xl font-bold">Roman A. Nosov</div></div></div><div class="mb-6 text-lg"><time dateTime="2020-06-07T14:15:07.322Z">June	7, 2020</time></div></div><div class="max-w-2xl mx-auto"><div class="markdown-styles_markdown__1x9gM"><p>На фоне эпидемии появилась необходимость в организации удобной удалённой работы на домашнем компьютере с ос <em>linux</em> на борту: настроить нормальный <em>rdp</em> клиент + <em>skype for business</em> (<em>lync</em>).</p>
<h3>Зачем?</h3>
<p>Не все работодатели готовы предоставлять работникам именно <em>VPN</em> для доступа к корпоративным сервисам. Лишь открывают RDP-терминал. Видимо, так им кажется безопаснее ¯\<em>(ツ)</em>/¯. Плюс, некоторые вещи физически невозможно развернуть на локальных машинах, так что приходится "выкручиваться" протоколом удалённых рабочих столов.</p>
<h3>Что нужно?</h3>
<ol>
<li>Нужен настроенный <em>RDP</em> клиент с поддержкой gateway на linux, который по одному клику открывает рабочий стол удалённой машины.</li>
<li>Нужна возможность созваниваться по skype for business с коллегами без огромных задержек от RDP. В идеале -- запуск клиента на локальной машине.</li>
</ol>
<h2>Добываем себе возможность работать в трусах</h2>
<p><img src="/assets/blog/remote-workplace-linux/meme.jpg" alt="Удалёнка">)</p>
<h3>RDP</h3>
<p>В качестве rdp клиента будем использовать <em>freerdp</em> -- из тех клиентов, что я знаю -- он единственный, который поддерживает шлюзы (gateways). Устанавливаем:</p>
<pre><code class="language-bash">sudo apt instal freerdp
</code></pre>
<p>Теперь запускать удалённые rdp-сеансы мы можем с помощью консольной команды xfreerdp. Определимся с параметрами:
Со всеми доступными параметрами можно <a href="https://github.com/FreeRDP/FreeRDP/wiki/CommandLineInterface" title="CommandLineInterface">познакомиться здесь</a>. Но нас интересуют вполне конкретные:
1. <strong>/f</strong> -- fullscreen mode
2. <strong>/multimon</strong> -- подддержка нескольких мониторов
3. <strong>/rfx</strong> -- "расширенный" протокол поверх RDP.
4. (опционально) <strong>/sound:sys:alsa</strong> -- вкючение стриминга звука на локальную машину
5. <strong>+clipboard</strong> -- расшаривание буфера обмена между удалённым рабочим столом и клиентской машиной
6. <strong>+fonts</strong> -- вкючить сглаживание шрифтов.
7. <strong>/v</strong> -- хост url
8. <strong>/d</strong> -- домен пользователя,
9. <strong>/u</strong> -- пользователь
10. <strong>/p</strong> -- пароль пользователя
11. <strong>/g</strong> -- шлюз url
12. <strong>/gd</strong> -- домен для авторизации на шлюзе
13. <strong>/gu</strong> -- пользователь для авторизации на шлюзе
14. <strong>/gp</strong> -- пароль для авторизации на шлюзе</p>
<p>Итоговый скрипт запуска у нас будет следующим:</p>
<pre><code class="language-bash">#! /bin/bash

xfreerdp /v:targetUrl /d:domain /u:username /p:password /g:gateway /gd:domain /gu:username /gp:password /f /multimon /rfx /sound:sys:alsa +clipboard +fonts
</code></pre>
<p>Всё это можно сохранить в текстовом файле, сделать его <em>executable</em> и положить для удобства на рабочий стол.</p>
<pre><code class="language-bash">sudo chmod +x filename #Сделать исполняемым
</code></pre>
<h3>Skype for business (lync)</h3>
<p>Несмотря на то, что обычная (не бизнесовая) версия скайпа официально поставляется разработчиками -- бизнесовой версии под linux <strong>нет</strong>. <em>Skype web app</em> тоже не заведется, т.к. для его функционирования нужно нативное windows-расширение для браузера. Как быть?</p>
<p>В этом нам поможет прекрасный плагин для мессенджеров -- <a href="https://sipe.sourceforge.io/" title="A third-party Pidgin plugin for Microsoft LCS/OCS">SIPE</a>. Он позиционирует себя как open-source имплементация протокола, по которому общаются клиенты <em>Skype for busines</em>.</p>
<p>Установим pidgin + sipe</p>
<pre><code class="language-bash">sudo apt install pidgin pidgin-sipe
</code></pre>
<p>При создании учетных записей выбираем протокол "Office Communicator"
<img src="/assets/blog/remote-workplace-linux/pidgin-protocols.png" alt="Pidgin protocols list"></p>
<p>Вводим active directory login/e-mail/пароль. И вуаля! Подключается и работает.</p>
<p>Поскольку, это не официальный клиент, многие (не основные) функции могут отсутствовать. Но базовых более чем хватает:
1. Чат
2. Звонки, как приватные, так и конференции.
3. Демонстрация рабочего стола
4. Совместное использование рабочего стола</p>
</div></div></article><article class="mb-32 max-w-2xl mx-auto"><hr class="mb-5"/><h2 class="text-2xl md:text-2xl lg:text-2xl font-bold tracking-tighter leading-tight md:leading-none mb-12 text-center md:text-center">Комментарии</h2><div class="md:flex p-6">Loading...</div><a href="https://github.com/JustAddAcid/JustAddAcid.github.io/issues/9" class="bg-white hover:bg-gray-100 text-gray-800 font-semibold py-2 px-4 border border-gray-400 rounded shadow mt-2 inline-block">Добавить комментарий</a></article></div></main></div><footer class="bg-accent-1 border-t border-accent-2"><div class="container mx-auto px-5"></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Организуем удалённое рабочее место на машине с linux","date":"2020-06-07T14:15:07.322Z","slug":"remote-workplace-linux","author":{"name":"Roman A. Nosov","picture":"/assets/blog/authors/romannosov.png"},"content":"\u003cp\u003eНа фоне эпидемии появилась необходимость в организации удобной удалённой работы на домашнем компьютере с ос \u003cem\u003elinux\u003c/em\u003e на борту: настроить нормальный \u003cem\u003erdp\u003c/em\u003e клиент + \u003cem\u003eskype for business\u003c/em\u003e (\u003cem\u003elync\u003c/em\u003e).\u003c/p\u003e\n\u003ch3\u003eЗачем?\u003c/h3\u003e\n\u003cp\u003eНе все работодатели готовы предоставлять работникам именно \u003cem\u003eVPN\u003c/em\u003e для доступа к корпоративным сервисам. Лишь открывают RDP-терминал. Видимо, так им кажется безопаснее ¯\\\u003cem\u003e(ツ)\u003c/em\u003e/¯. Плюс, некоторые вещи физически невозможно развернуть на локальных машинах, так что приходится \"выкручиваться\" протоколом удалённых рабочих столов.\u003c/p\u003e\n\u003ch3\u003eЧто нужно?\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003eНужен настроенный \u003cem\u003eRDP\u003c/em\u003e клиент с поддержкой gateway на linux, который по одному клику открывает рабочий стол удалённой машины.\u003c/li\u003e\n\u003cli\u003eНужна возможность созваниваться по skype for business с коллегами без огромных задержек от RDP. В идеале -- запуск клиента на локальной машине.\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2\u003eДобываем себе возможность работать в трусах\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"/assets/blog/remote-workplace-linux/meme.jpg\" alt=\"Удалёнка\"\u003e)\u003c/p\u003e\n\u003ch3\u003eRDP\u003c/h3\u003e\n\u003cp\u003eВ качестве rdp клиента будем использовать \u003cem\u003efreerdp\u003c/em\u003e -- из тех клиентов, что я знаю -- он единственный, который поддерживает шлюзы (gateways). Устанавливаем:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003esudo apt instal freerdp\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eТеперь запускать удалённые rdp-сеансы мы можем с помощью консольной команды xfreerdp. Определимся с параметрами:\nСо всеми доступными параметрами можно \u003ca href=\"https://github.com/FreeRDP/FreeRDP/wiki/CommandLineInterface\" title=\"CommandLineInterface\"\u003eпознакомиться здесь\u003c/a\u003e. Но нас интересуют вполне конкретные:\n1. \u003cstrong\u003e/f\u003c/strong\u003e -- fullscreen mode\n2. \u003cstrong\u003e/multimon\u003c/strong\u003e -- подддержка нескольких мониторов\n3. \u003cstrong\u003e/rfx\u003c/strong\u003e -- \"расширенный\" протокол поверх RDP.\n4. (опционально) \u003cstrong\u003e/sound:sys:alsa\u003c/strong\u003e -- вкючение стриминга звука на локальную машину\n5. \u003cstrong\u003e+clipboard\u003c/strong\u003e -- расшаривание буфера обмена между удалённым рабочим столом и клиентской машиной\n6. \u003cstrong\u003e+fonts\u003c/strong\u003e -- вкючить сглаживание шрифтов.\n7. \u003cstrong\u003e/v\u003c/strong\u003e -- хост url\n8. \u003cstrong\u003e/d\u003c/strong\u003e -- домен пользователя,\n9. \u003cstrong\u003e/u\u003c/strong\u003e -- пользователь\n10. \u003cstrong\u003e/p\u003c/strong\u003e -- пароль пользователя\n11. \u003cstrong\u003e/g\u003c/strong\u003e -- шлюз url\n12. \u003cstrong\u003e/gd\u003c/strong\u003e -- домен для авторизации на шлюзе\n13. \u003cstrong\u003e/gu\u003c/strong\u003e -- пользователь для авторизации на шлюзе\n14. \u003cstrong\u003e/gp\u003c/strong\u003e -- пароль для авторизации на шлюзе\u003c/p\u003e\n\u003cp\u003eИтоговый скрипт запуска у нас будет следующим:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e#! /bin/bash\n\nxfreerdp /v:targetUrl /d:domain /u:username /p:password /g:gateway /gd:domain /gu:username /gp:password /f /multimon /rfx /sound:sys:alsa +clipboard +fonts\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eВсё это можно сохранить в текстовом файле, сделать его \u003cem\u003eexecutable\u003c/em\u003e и положить для удобства на рабочий стол.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003esudo chmod +x filename #Сделать исполняемым\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eSkype for business (lync)\u003c/h3\u003e\n\u003cp\u003eНесмотря на то, что обычная (не бизнесовая) версия скайпа официально поставляется разработчиками -- бизнесовой версии под linux \u003cstrong\u003eнет\u003c/strong\u003e. \u003cem\u003eSkype web app\u003c/em\u003e тоже не заведется, т.к. для его функционирования нужно нативное windows-расширение для браузера. Как быть?\u003c/p\u003e\n\u003cp\u003eВ этом нам поможет прекрасный плагин для мессенджеров -- \u003ca href=\"https://sipe.sourceforge.io/\" title=\"A third-party Pidgin plugin for Microsoft LCS/OCS\"\u003eSIPE\u003c/a\u003e. Он позиционирует себя как open-source имплементация протокола, по которому общаются клиенты \u003cem\u003eSkype for busines\u003c/em\u003e.\u003c/p\u003e\n\u003cp\u003eУстановим pidgin + sipe\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003esudo apt install pidgin pidgin-sipe\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eПри создании учетных записей выбираем протокол \"Office Communicator\"\n\u003cimg src=\"/assets/blog/remote-workplace-linux/pidgin-protocols.png\" alt=\"Pidgin protocols list\"\u003e\u003c/p\u003e\n\u003cp\u003eВводим active directory login/e-mail/пароль. И вуаля! Подключается и работает.\u003c/p\u003e\n\u003cp\u003eПоскольку, это не официальный клиент, многие (не основные) функции могут отсутствовать. Но базовых более чем хватает:\n1. Чат\n2. Звонки, как приватные, так и конференции.\n3. Демонстрация рабочего стола\n4. Совместное использование рабочего стола\u003c/p\u003e\n","ogImage":{"url":"/assets/blog/remote-workplace-linux/logo.jpg"},"coverImage":"/assets/blog/remote-workplace-linux/logo.jpg","issueId":"9"}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"remote-workplace-linux"},"buildId":"gJJRndGKyN6sCjXIhsPQK","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/runtime/polyfills-f500672a22b5a3a6edae.js"></script><script async="" data-next-page="/_app" src="/_next/static/gJJRndGKyN6sCjXIhsPQK/pages/_app.js"></script><script async="" data-next-page="/posts/[slug]" src="/_next/static/gJJRndGKyN6sCjXIhsPQK/pages/posts/%5Bslug%5D.js"></script><script src="/_next/static/runtime/webpack-c212667a5f965e81e004.js" async=""></script><script src="/_next/static/chunks/framework.e84fa698c7ee940652bd.js" async=""></script><script src="/_next/static/chunks/4f691431.e05b9cac0aab3e16d0b1.js" async=""></script><script src="/_next/static/chunks/commons.ceeeee915f5ebe162cf6.js" async=""></script><script src="/_next/static/runtime/main-3daf36a84c7bc857251c.js" async=""></script><script src="/_next/static/chunks/6bb8d0b32c277f4d448b0d2b473f0efce76a1e26.d11d7791f553e1ee81f3.js" async=""></script><script src="/_next/static/gJJRndGKyN6sCjXIhsPQK/_buildManifest.js" async=""></script><script src="/_next/static/gJJRndGKyN6sCjXIhsPQK/_ssgManifest.js" async=""></script></body></html>