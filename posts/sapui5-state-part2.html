<!DOCTYPE html><html lang="ru"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"/><link rel="manifest" href="/favicon/site.webmanifest"/><link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#000000"/><link rel="shortcut icon" href="/favicon/favicon.ico"/><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-config" content="/favicon/browserconfig.xml"/><meta name="theme-color" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><meta name="description" content="Nosoff.info -- personal blog"/><title>Как запилить рективность на SAPUI5 -- часть 2</title><meta property="og:image" content="/assets/blog/sapui5-state-part2/background.jpg"/><meta name="next-head-count" content="15"/><link rel="preload" href="/_next/static/css/b53dc93c726b8658a966.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b53dc93c726b8658a966.css"/><link rel="preload" href="/_next/static/css/660f735cfd0633f1a2b3.css" as="style"/><link rel="stylesheet" href="/_next/static/css/660f735cfd0633f1a2b3.css"/><link rel="preload" href="/_next/static/css/c77a6c1079e98ec5fcc2.css" as="style"/><link rel="stylesheet" href="/_next/static/css/c77a6c1079e98ec5fcc2.css"/><link rel="preload" href="/_next/static/Q293hHAA-_AtTLioDkyNL/pages/_app.js" as="script"/><link rel="preload" href="/_next/static/Q293hHAA-_AtTLioDkyNL/pages/posts/%5Bslug%5D.js" as="script"/><link rel="preload" href="/_next/static/runtime/webpack-c212667a5f965e81e004.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.e84fa698c7ee940652bd.js" as="script"/><link rel="preload" href="/_next/static/chunks/4f691431.e05b9cac0aab3e16d0b1.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.34684228d50c6c140f9e.js" as="script"/><link rel="preload" href="/_next/static/runtime/main-720adcafaeb0cbb96e72.js" as="script"/><link rel="preload" href="/_next/static/chunks/bc87f68faf7885c35b8e03f25f08991c50564393.a375015dfeaf3415b9d5.js" as="script"/></head><body><div id="__next"><div class="min-h-screen"><main><div class="container mx-auto px-5"><h2 class="text-2xl md:text-4xl font-bold tracking-tight md:tracking-tighter leading-tight mb-20 mt-8"><a class="hover:underline" href="/">Nosoff.info</a></h2><article class="mb-32"><h1 class="text-6xl md:text-7xl lg:text-8xl font-bold tracking-tighter leading-tight md:leading-none mb-12 text-center md:text-left">Как запилить рективность на SAPUI5 -- часть 2</h1><div class="hidden md:block md:mb-12"><div class="flex items-center"><img src="/assets/blog/authors/romannosov.png" class="w-12 h-12 rounded-full mr-4" alt="Roman A. Nosov"/><div class="text-xl font-bold">Roman A. Nosov</div></div></div><div class="mb-8 md:mb-16 -mx-5 sm:mx-0"><div class="-mx-5 sm:mx-0"><img src="/assets/blog/sapui5-state/cover.jpg" alt="Cover Image for Как запилить рективность на SAPUI5 -- часть 2" class="shadow-small"/></div></div><div class="max-w-2xl mx-auto"><div class="block md:hidden mb-6"><div class="flex items-center"><img src="/assets/blog/authors/romannosov.png" class="w-12 h-12 rounded-full mr-4" alt="Roman A. Nosov"/><div class="text-xl font-bold">Roman A. Nosov</div></div></div><div class="mb-6 text-lg"><time dateTime="2020-06-21T14:15:07.322Z">June	21, 2020</time></div></div><div class="max-w-2xl mx-auto"><div class="markdown-styles_markdown__1x9gM"><p>С концептом реактивности в <em>SAPUI5</em> немного разобрались. Осталось углубиться в эту тему чуть-чуть подробнее: разобраться с тем, что же такое <em>expression binding</em> и с чем его едят, а также разобраться с вопросом -- как подписываться на изменение <em>viewState</em> и выполнять по этому событию какой-либо код. </p>
<p><img src="/assets/blog/sapui5-state-part2/%D1%81_%D1%87%D0%B5%D0%BC_%D0%B5%D0%B3%D0%BE_%D0%B5%D0%B4%D1%8F%D1%82.jpg" alt="Что же такое expression binding и с чем его едят"></p>
<h2>Что же такое expression binding и с чем его едят</h2>
<p>В прошлой статье я немного рассказывал о реактивности в sapui5 и показывал пример байндинга контроллов к данным. Если ещё не читали, то <a href="/posts/sapui5-state">(велкам сюда)</a>.</p>
<p>В тех примерах, байндинги описывались прямо в xml верстке в нужных нам проперти</p>
<p>Примерно вот в таком формате:</p>
<pre><code class="language-xml">&#x3C;Control property="{modelName>modelProp}"/>
</code></pre>
<p>В этом случае, в проперти контрола автоматически будет попадать значение из модели, и автоматически обновляться, если данные в модели изменились.</p>
<p>Но это далеко не всё, что мы можем описать прямо во вью в декларативном стиле. Иногда очень хочется как-либо <strong>вычислять</strong> значение поля на основании данных в модели, а не просто выводить какое-то значение.</p>
<p><strong>Например:</strong>
1. подкрашивать красным строки таблицы, где значение какого-нибудь столбца меньше нуля
2. активировать/деактивировать на основании данных кнопки
3. выводить количество записей в масииве и т.д.</p>
<p><em>Ремарка: сейчас речь пойдет только про </em>expression binding<em>. Про форматтеры поговорим как-нибудь в другой раз.</em></p>
<p>И такой функционал вычисления свойств <em>sapui5</em> нам охотно может предоставить.</p>
<p>Всё это выглядит следующим образом: сразу после открывающейся фигурной скобки нужно выставить знак равенства, тогда парсер поймет, что дальше будет какое-то вычисляемое поле на js. Далее можно вставить маленький кусочек <em>javaScript</em>, который будет выполняться при вычислении содержимого поля.
<em>(Вставлять туда можно константы, вызовы функций, тренарные?операторы:, регэкспы и прочие прелести жизни.)</em></p>
<p>Главное -- не переусердствовать и не превратить разметку страницы в помойку. :)</p>
<pre><code class="language-xml">&#x3C;Control property="{= JS_CODE}"/>
</code></pre>
<p>Ссылаться на содержимое модели можно с помощью конструкции <strong>${}</strong>. Например: </p>
<pre><code class="language-xml">&#x3C;Text text="{= 'Hello, ' + ${user>name}}">
</code></pre>
<p>В данном случае, после "Hello, " будет подставлено "name" из модели "user". И если где-то в дальнейшем коде значение этого поля в модели изменится -- автоматически произойдет повторное вычисление всех expression bindings, связанных с этим полем.</p>
<p><strong>Ахтунг:</strong>
Будьте внимательны с boolean-аттрибутами! </p>
<pre><code class="language-xml">&#x3C;Button enabled="{= someFunction( ${model>prop} )}">
</code></pre>
<p>В примере выше, значение <em>enabled</em>, которое принимает тип bool принимается из результата функции <em>someFunction</em>. Но если по каким-то причинам из функции возвратится <strong>undefined</strong>, то это значение не будет воспринято как <em>falsy</em> (как во всём остальном js), а мистическим образом конвертируется в true. Так что, конкретно в этом случае, может быть оправдана вот такая грязная и некрасивая запись (за которую, вам могут ударить по рукам):</p>
<pre><code class="language-xml">&#x3C;Button enabled="{= !!someFunction( ${model>prop} )}">
&#x3C;!-- или -->
&#x3C;Button enabled="{= someFunction( ${model>prop} ) ? true : false }">
</code></pre>
<p>Попробую привести более полные и понятные примеры того, где эти <em>expression bindings</em> можно удобно использовать:</p>
<h3>Раскрывающееся меню</h3>
<p>Допустим, нам требуется выпадающее меню вот с таким поведением: при нажатии на toggleButton должна меняться иконка и открываться дочерняя ветка меню. Как это сделать почти не прибегая к <em>javaScript</em>?</p>
<p><img src="/assets/blog/sapui5-state-part2/menu%20closed.png" alt="menu closed">
<img src="/assets/blog/sapui5-state-part2/menu%20opened.png" alt="menu opened"></p>
<p>Очень просто: использовать для иконок тренарный оператор, который будет вычислять нужную нам иконку. А "дочернюю" ветку меню заключить в блок, который делать видимым тогда, когда свойство TransportEnabled в модели будет = true.</p>
<p>Пример верстки: (проперти, не относящиеся к обсуждаемой теме удалены для наглядности)</p>
<pre><code class="language-xml">&#x3C;VBox>
  &#x3C;ToggleButton text="Движение транспорта"
    icon="{= ${/TransportEnabled} ? 'иконка вкл' : 'иконка выкл'"
    pressed="{/TransportEnabled}"/>
  &#x3C;VBox visible="{/TransportEnabled}">
    &#x3C;ToggleButton text="В пути" 
      icon="{= ${/TransportOnWay} ? 'иконка вкл' : 'иконка выкл'}"
      pressed="{/TransportOnWay}"/>
    &#x3C;ToggleButton text="На подходе"
      icon="{= ${/TransportApproaching} ? 'иконка вкл' : 'иконка выкл'}"
      pressed="{/TransportApproaching}"/>
    &#x3C;ToggleButton text="Прибыл" 
      icon="{= ${/TransportArrived} ? 'иконка вкл' : 'иконка выкл'}"
      pressed="{/TransportArrived}"/>
  &#x3C;/VBox>
&#x3C;/VBox>
</code></pre>
<h3>Калькулятор</h3>
<p>Допустим, мы захотели написать простой калькулятор на <em>sapui5</em>. Как нам организовать блокировку кнопки "decimal point", когда точка уже введена пользователем? </p>
<p><img src="/assets/blog/sapui5-state-part2/calc%20before.png" alt="calc before">
<img src="/assets/blog/sapui5-state-part2/calc%20after.png" alt="calc after"></p>
<p><em>Не сильно заметно, но на втором скрине кнопка заблокирована</em></p>
<p>Можно городить отдельный метод проверки, а можно сделать вот так:</p>
<pre><code class="language-xml">&#x3C;!-- Само поле ввода чисел в калькулятор -->
&#x3C;Input enabled="false" value="{viewState>/input}"/>

&#x3C;!-- ... -->

&#x3C;Button text="." 
  press="appendSymbolToLine" 
  enabled="{= !${viewState>/input}.includes('.') }"/>
</code></pre>
<p>Просто проверять, есть ли в строке ввода точки :)</p>
<p><strong>И напоследок расскажу, как привязывать хендлеры к событию изменения конкретного проперти в JSON-модели:</strong></p>
<p>Хитрость заключается в том, что если для этого мы будем использовать класс <strong>sap.ui.model.Binding</strong>, то у нас ничего хорошего не получится. Т.к. хендлер будет запускаться каждый раз, когда изменится <strong>вообще какое-либо</strong> поле в этой модели. </p>
<p>А для привязки к конкретному полю существует специальный класс: <strong>sap.ui.model.json.JSONPropertyBinding</strong>.</p>
<p>Давайте для примера прикрутим к нашему калькулятору какой-нибудь хендлер изменения данных в модели. Например, будем рисовать toast-сообщение, при записи значения в память нашего калькулятора (при нажатии кнопок M+ и M-)</p>
<p>Для удобства напишем метод, который будет принимать два аргумента: путь до проперти модели, за которым будем наблюдать; и функцию, которая будет запускаться при изменении этого поля:</p>
<pre><code class="language-javascript">  addViewStateListener: function(path, callback) {
    var oBinding = new sap.ui.model.json.JSONPropertyBinding(this.viewState, path);
    oBinding.attachChange(callback);
  }
</code></pre>
<p>Затем напишем функцию, вызывающую сообщение и привяжем её к проперти</p>
<pre><code class="language-javascript">  memoryUsage: function(event){
    sap.m.MessageToast.show("Memory usage! Set " + event.getSource().getValue());
  }

  // [....]
        onInit: function() {
      // [....]
      // При инициализации привязываем нашу функцию к проперти модели
            this.addViewStateListener("/memory", this.memoryUsage);
        },
</code></pre>
<p>Готово! При нажатии на m+ получаем вот такое сообщение:</p>
<p><img src="/assets/blog/sapui5-state-part2/calc_handler.jpg" alt="Calc handler"></p>
<p>Как всегда, код примера <a href="https://github.com/JustAddAcid/sapui5-calculator">((вот здесь))</a></p>
<p>Ещё увидимся</p>
</div></div></article><article class="mb-32 max-w-2xl mx-auto"><hr class="mb-5"/><h2 class="text-2xl md:text-2xl lg:text-2xl font-bold tracking-tighter leading-tight md:leading-none mb-12 text-center md:text-center">Комментарии</h2><div class="md:flex p-6">Loading...</div><a href="https://github.com/JustAddAcid/JustAddAcid.github.io/issues/11" class="bg-white hover:bg-gray-100 text-gray-800 font-semibold py-2 px-4 border border-gray-400 rounded shadow mt-2 inline-block">Добавить комментарий</a></article></div></main></div><footer class="bg-accent-1 border-t border-accent-2"><div class="container mx-auto px-5"></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Как запилить рективность на SAPUI5 -- часть 2","date":"2020-06-21T14:15:07.322Z","slug":"sapui5-state-part2","author":{"name":"Roman A. Nosov","picture":"/assets/blog/authors/romannosov.png"},"content":"\u003cp\u003eС концептом реактивности в \u003cem\u003eSAPUI5\u003c/em\u003e немного разобрались. Осталось углубиться в эту тему чуть-чуть подробнее: разобраться с тем, что же такое \u003cem\u003eexpression binding\u003c/em\u003e и с чем его едят, а также разобраться с вопросом -- как подписываться на изменение \u003cem\u003eviewState\u003c/em\u003e и выполнять по этому событию какой-либо код. \u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/blog/sapui5-state-part2/%D1%81_%D1%87%D0%B5%D0%BC_%D0%B5%D0%B3%D0%BE_%D0%B5%D0%B4%D1%8F%D1%82.jpg\" alt=\"Что же такое expression binding и с чем его едят\"\u003e\u003c/p\u003e\n\u003ch2\u003eЧто же такое expression binding и с чем его едят\u003c/h2\u003e\n\u003cp\u003eВ прошлой статье я немного рассказывал о реактивности в sapui5 и показывал пример байндинга контроллов к данным. Если ещё не читали, то \u003ca href=\"/posts/sapui5-state\"\u003e(велкам сюда)\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eВ тех примерах, байндинги описывались прямо в xml верстке в нужных нам проперти\u003c/p\u003e\n\u003cp\u003eПримерно вот в таком формате:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-xml\"\u003e\u0026#x3C;Control property=\"{modelName\u003emodelProp}\"/\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eВ этом случае, в проперти контрола автоматически будет попадать значение из модели, и автоматически обновляться, если данные в модели изменились.\u003c/p\u003e\n\u003cp\u003eНо это далеко не всё, что мы можем описать прямо во вью в декларативном стиле. Иногда очень хочется как-либо \u003cstrong\u003eвычислять\u003c/strong\u003e значение поля на основании данных в модели, а не просто выводить какое-то значение.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eНапример:\u003c/strong\u003e\n1. подкрашивать красным строки таблицы, где значение какого-нибудь столбца меньше нуля\n2. активировать/деактивировать на основании данных кнопки\n3. выводить количество записей в масииве и т.д.\u003c/p\u003e\n\u003cp\u003e\u003cem\u003eРемарка: сейчас речь пойдет только про \u003c/em\u003eexpression binding\u003cem\u003e. Про форматтеры поговорим как-нибудь в другой раз.\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003eИ такой функционал вычисления свойств \u003cem\u003esapui5\u003c/em\u003e нам охотно может предоставить.\u003c/p\u003e\n\u003cp\u003eВсё это выглядит следующим образом: сразу после открывающейся фигурной скобки нужно выставить знак равенства, тогда парсер поймет, что дальше будет какое-то вычисляемое поле на js. Далее можно вставить маленький кусочек \u003cem\u003ejavaScript\u003c/em\u003e, который будет выполняться при вычислении содержимого поля.\n\u003cem\u003e(Вставлять туда можно константы, вызовы функций, тренарные?операторы:, регэкспы и прочие прелести жизни.)\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003eГлавное -- не переусердствовать и не превратить разметку страницы в помойку. :)\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-xml\"\u003e\u0026#x3C;Control property=\"{= JS_CODE}\"/\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eСсылаться на содержимое модели можно с помощью конструкции \u003cstrong\u003e${}\u003c/strong\u003e. Например: \u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-xml\"\u003e\u0026#x3C;Text text=\"{= 'Hello, ' + ${user\u003ename}}\"\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eВ данном случае, после \"Hello, \" будет подставлено \"name\" из модели \"user\". И если где-то в дальнейшем коде значение этого поля в модели изменится -- автоматически произойдет повторное вычисление всех expression bindings, связанных с этим полем.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eАхтунг:\u003c/strong\u003e\nБудьте внимательны с boolean-аттрибутами! \u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-xml\"\u003e\u0026#x3C;Button enabled=\"{= someFunction( ${model\u003eprop} )}\"\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eВ примере выше, значение \u003cem\u003eenabled\u003c/em\u003e, которое принимает тип bool принимается из результата функции \u003cem\u003esomeFunction\u003c/em\u003e. Но если по каким-то причинам из функции возвратится \u003cstrong\u003eundefined\u003c/strong\u003e, то это значение не будет воспринято как \u003cem\u003efalsy\u003c/em\u003e (как во всём остальном js), а мистическим образом конвертируется в true. Так что, конкретно в этом случае, может быть оправдана вот такая грязная и некрасивая запись (за которую, вам могут ударить по рукам):\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-xml\"\u003e\u0026#x3C;Button enabled=\"{= !!someFunction( ${model\u003eprop} )}\"\u003e\n\u0026#x3C;!-- или --\u003e\n\u0026#x3C;Button enabled=\"{= someFunction( ${model\u003eprop} ) ? true : false }\"\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eПопробую привести более полные и понятные примеры того, где эти \u003cem\u003eexpression bindings\u003c/em\u003e можно удобно использовать:\u003c/p\u003e\n\u003ch3\u003eРаскрывающееся меню\u003c/h3\u003e\n\u003cp\u003eДопустим, нам требуется выпадающее меню вот с таким поведением: при нажатии на toggleButton должна меняться иконка и открываться дочерняя ветка меню. Как это сделать почти не прибегая к \u003cem\u003ejavaScript\u003c/em\u003e?\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/blog/sapui5-state-part2/menu%20closed.png\" alt=\"menu closed\"\u003e\n\u003cimg src=\"/assets/blog/sapui5-state-part2/menu%20opened.png\" alt=\"menu opened\"\u003e\u003c/p\u003e\n\u003cp\u003eОчень просто: использовать для иконок тренарный оператор, который будет вычислять нужную нам иконку. А \"дочернюю\" ветку меню заключить в блок, который делать видимым тогда, когда свойство TransportEnabled в модели будет = true.\u003c/p\u003e\n\u003cp\u003eПример верстки: (проперти, не относящиеся к обсуждаемой теме удалены для наглядности)\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-xml\"\u003e\u0026#x3C;VBox\u003e\n  \u0026#x3C;ToggleButton text=\"Движение транспорта\"\n    icon=\"{= ${/TransportEnabled} ? 'иконка вкл' : 'иконка выкл'\"\n    pressed=\"{/TransportEnabled}\"/\u003e\n  \u0026#x3C;VBox visible=\"{/TransportEnabled}\"\u003e\n    \u0026#x3C;ToggleButton text=\"В пути\" \n      icon=\"{= ${/TransportOnWay} ? 'иконка вкл' : 'иконка выкл'}\"\n      pressed=\"{/TransportOnWay}\"/\u003e\n    \u0026#x3C;ToggleButton text=\"На подходе\"\n      icon=\"{= ${/TransportApproaching} ? 'иконка вкл' : 'иконка выкл'}\"\n      pressed=\"{/TransportApproaching}\"/\u003e\n    \u0026#x3C;ToggleButton text=\"Прибыл\" \n      icon=\"{= ${/TransportArrived} ? 'иконка вкл' : 'иконка выкл'}\"\n      pressed=\"{/TransportArrived}\"/\u003e\n  \u0026#x3C;/VBox\u003e\n\u0026#x3C;/VBox\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eКалькулятор\u003c/h3\u003e\n\u003cp\u003eДопустим, мы захотели написать простой калькулятор на \u003cem\u003esapui5\u003c/em\u003e. Как нам организовать блокировку кнопки \"decimal point\", когда точка уже введена пользователем? \u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/blog/sapui5-state-part2/calc%20before.png\" alt=\"calc before\"\u003e\n\u003cimg src=\"/assets/blog/sapui5-state-part2/calc%20after.png\" alt=\"calc after\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cem\u003eНе сильно заметно, но на втором скрине кнопка заблокирована\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003eМожно городить отдельный метод проверки, а можно сделать вот так:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-xml\"\u003e\u0026#x3C;!-- Само поле ввода чисел в калькулятор --\u003e\n\u0026#x3C;Input enabled=\"false\" value=\"{viewState\u003e/input}\"/\u003e\n\n\u0026#x3C;!-- ... --\u003e\n\n\u0026#x3C;Button text=\".\" \n  press=\"appendSymbolToLine\" \n  enabled=\"{= !${viewState\u003e/input}.includes('.') }\"/\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eПросто проверять, есть ли в строке ввода точки :)\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eИ напоследок расскажу, как привязывать хендлеры к событию изменения конкретного проперти в JSON-модели:\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eХитрость заключается в том, что если для этого мы будем использовать класс \u003cstrong\u003esap.ui.model.Binding\u003c/strong\u003e, то у нас ничего хорошего не получится. Т.к. хендлер будет запускаться каждый раз, когда изменится \u003cstrong\u003eвообще какое-либо\u003c/strong\u003e поле в этой модели. \u003c/p\u003e\n\u003cp\u003eА для привязки к конкретному полю существует специальный класс: \u003cstrong\u003esap.ui.model.json.JSONPropertyBinding\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003eДавайте для примера прикрутим к нашему калькулятору какой-нибудь хендлер изменения данных в модели. Например, будем рисовать toast-сообщение, при записи значения в память нашего калькулятора (при нажатии кнопок M+ и M-)\u003c/p\u003e\n\u003cp\u003eДля удобства напишем метод, который будет принимать два аргумента: путь до проперти модели, за которым будем наблюдать; и функцию, которая будет запускаться при изменении этого поля:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003e  addViewStateListener: function(path, callback) {\n    var oBinding = new sap.ui.model.json.JSONPropertyBinding(this.viewState, path);\n    oBinding.attachChange(callback);\n  }\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eЗатем напишем функцию, вызывающую сообщение и привяжем её к проперти\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003e  memoryUsage: function(event){\n    sap.m.MessageToast.show(\"Memory usage! Set \" + event.getSource().getValue());\n  }\n\n  // [....]\n        onInit: function() {\n      // [....]\n      // При инициализации привязываем нашу функцию к проперти модели\n            this.addViewStateListener(\"/memory\", this.memoryUsage);\n        },\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eГотово! При нажатии на m+ получаем вот такое сообщение:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/blog/sapui5-state-part2/calc_handler.jpg\" alt=\"Calc handler\"\u003e\u003c/p\u003e\n\u003cp\u003eКак всегда, код примера \u003ca href=\"https://github.com/JustAddAcid/sapui5-calculator\"\u003e((вот здесь))\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eЕщё увидимся\u003c/p\u003e\n","ogImage":{"url":"/assets/blog/sapui5-state-part2/background.jpg"},"coverImage":"/assets/blog/sapui5-state/cover.jpg","issueId":"11"}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"sapui5-state-part2"},"buildId":"Q293hHAA-_AtTLioDkyNL","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/runtime/polyfills-f500672a22b5a3a6edae.js"></script><script async="" data-next-page="/_app" src="/_next/static/Q293hHAA-_AtTLioDkyNL/pages/_app.js"></script><script async="" data-next-page="/posts/[slug]" src="/_next/static/Q293hHAA-_AtTLioDkyNL/pages/posts/%5Bslug%5D.js"></script><script src="/_next/static/runtime/webpack-c212667a5f965e81e004.js" async=""></script><script src="/_next/static/chunks/framework.e84fa698c7ee940652bd.js" async=""></script><script src="/_next/static/chunks/4f691431.e05b9cac0aab3e16d0b1.js" async=""></script><script src="/_next/static/chunks/commons.34684228d50c6c140f9e.js" async=""></script><script src="/_next/static/runtime/main-720adcafaeb0cbb96e72.js" async=""></script><script src="/_next/static/chunks/bc87f68faf7885c35b8e03f25f08991c50564393.a375015dfeaf3415b9d5.js" async=""></script><script src="/_next/static/Q293hHAA-_AtTLioDkyNL/_buildManifest.js" async=""></script><script src="/_next/static/Q293hHAA-_AtTLioDkyNL/_ssgManifest.js" async=""></script></body></html>